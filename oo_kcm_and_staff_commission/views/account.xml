<?xml version='1.0' encoding='utf-8'?>
<odoo>
  <data noupdate="0">

    <!-- account.move inherit tree view -->
    <record id="oo_view_in_invoice_tree" model="ir.ui.view">
      <field name="name">account.move.inherit.view.tree</field>
      <field name="model">account.move</field>
      <field name="inherit_id" ref="account.view_in_invoice_tree" />
      <field name="arch" type="xml">

        <xpath expr="//field[@name='ref']" position="after">
          <field name="is_a_kcm_bill" />
          <field name="kcm_origin_id" optional="hide" />
        </xpath>

      </field>
    </record>

    <!-- account.move inherit search view -->
    <record id="oo_view_account_invoice_filter" model="ir.ui.view">
      <field name="name">account.move.inherit.view.search</field>
      <field name="model">account.move</field>
      <field name="inherit_id" ref="account.view_account_invoice_filter" />
      <field name="arch" type="xml">

        <xpath expr="//search" position="inside">
          <filter string="KCM Bills" name="kcm_bill" domain="[('is_a_kcm_bill', '=', True)]" />
        </xpath>

      </field>
    </record>

    <!-- account.move inherit form view -->
    <record id="oo_view_move_form" model="ir.ui.view">
      <field name="name">account.move.inherit.view.form</field>
      <field name="model">account.move</field>
      <field name="inherit_id" ref="account.view_move_form" />
      <field name="arch" type="xml">

        <xpath expr="//form/header[1]" position="inside">
          <button string="Create KCM Commission Bill" name="create_kcm_commission_bill" type="object" class="oe_highlight" attrs="{'invisible': ['|','|',('move_type','!=','out_invoice'),('has_kcm','!=', True), ('state','!=', 'posted')]}" />

          <button string="Create Sales Commission" name="update_salesperson_commission" type="object" class="oe_highlight" attrs="{'invisible': ['|',('move_type','!=','out_invoice'),('state','!=', 'posted')]}" />
        </xpath>

        <xpath expr="//form/sheet[1]/div[@name='button_box']" position="inside">
          <button name="show_kcm_commission_bills" type="object" class="oe_stat_button text-center" icon="fa-exchange" attrs="{'invisible': [('total_kcm_commission_bills','=', 0)]}">
            <field name="total_kcm_commission_bills" string="Kcm Commission Bills" widget="statinfo" />
          </button>

          <button disabled="1" class="oe_stat_button text-center" attrs="{'invisible': [('move_type','!=', 'out_invoice')]}">
            <field name="total_sales_commission" />
            <p>Sales Commission</p>
          </button>

        </xpath>

        <xpath expr="//group[@id='header_right_group']" position="after">
          <group>
            <field name="has_kcm" attrs="{'invisible': [('move_type','not in', ['out_invoice'])]}" />
            <field name="kcm_partner_id" attrs="{'invisible': [('has_kcm','!=', True)], 'required': [('has_kcm','=', True)] }" />
            <field name="kcm_percentage" attrs="{'invisible': [('has_kcm','!=', True)], 'required': [('has_kcm','=', True)] }" />
            <field name="is_default_staff_comm" invisible="1" />

            <field name="sale_comm_percentage" attrs="{'invisible': [('move_type','not in', ['out_invoice'])],'readonly': [('is_default_staff_comm','=', True)]}" />
            <p class="text-muted" attrs="{'invisible': [('move_type','not in', ['out_invoice'])]}">Newmatic percentage defaults to 1.5% if none of the lines quantity is greater than or equal to 10</p>

            <field name="is_a_kcm_bill" invisible="1" />
            <field name="kcm_origin_id" attrs="{'invisible': ['|',('move_type','not in', ['in_invoice']),('is_a_kcm_bill','=',False)]}" />
          </group>
        </xpath>

      </field>
    </record>

  </data>
</odoo>
